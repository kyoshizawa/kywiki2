# 概要

## 改訂履歴

| バージョン | 日付       | 改定内容 | 改定者    |
| ---------- | ---------- | -------- | --------- |
| v0.1       | 2026-01-28 | 初版作成 | 内川 修司 |
| v0.2       | 2026-02-09 | 非機能要件 レスポンスタイムの記載を修正。 機能要件, 移行計画へのリンク追加 | k_yoshizawa |

---

## 1. プロジェクト概要

### 背景
CAFIS/CARDNET接続用ネットワーク中継パッケージソフト「FEXICS」がメーカー保守終了（EOL）を迎えるとともに、サポート対象のWindows OSのサポート期限（EOL）が**2027年1月**に迫っている。
既存のパッケージソフトを継続・更新する場合、1億円以上の多額なコストが発生する課題がある。
※本プロジェクトでは、2027年1月の本来の期限超過後も暫定的な保守（延長サポート等）を継続しつつ、現実的な目標として**2027年度中（中旬頃）**の移行完了を目指す。

### 目的
1.  **事業継続性の確保**: 2027年度中（中旬頃）の代替ソリューションへの完全移行を完遂し、決済サービスの継続性を担保する。
2.  **コスト削減（原価低減）**: パッケージソフトの購入費用（1億円〜）を回避するため、機能を自社開発（内製化）することで大幅なコスト削減を実現する。

### 主な取り組み
*   **FEXICS代替機能の自社開発**: 2027年度中の完全移行を目指し、CAFIS/CARDNET接続用モジュールを自社で構築・実装する。
*   **自社基盤への集約**: 外部パッケージ依存を解消し、自社で保守・コントロール可能な基盤へと移行する。
*   **SaaS化の検討（将来構想）**: 自社構築した機能を将来的にSaaSとして外販、または他社とインフラをシェアすることで維持・運用費を削減するモデルの検討を行う。

### 移行計画
[移行計画](./04-migration_plan.md) を参照。

---

## 2. アーキテクチャ概要

FEXICSおよびCAFIS通信アプリ（AP03）を廃止し、新規に**Routing Engine**と**Gateway Service**を開発する。
業務アプリ（AP02/AP22）からの電文をRouting Engineで仕向け先判定し、回線ごとに配置されたGateway ServiceがCAFIS/CARDNETとの接続・電文変換を担う。

```
業務アプリ → Routing Engine → Gateway Service → CAFIS/CARDNET
                                    ↑
                              回線ごとに配置
```

詳細は [アーキテクチャ設計案](./02-architecture_proposal.md) を参照。

---

## 3. 機能要件

### 廃止対象

| コンポーネント | 理由 |
|---------------|------|
| FEXICS | EOL対応（本プロジェクトの主目的） |
| AP03 CAFIS通信アプリ | FEXICS前提の設計、機能を新コンポーネントに統合 |

### 新規コンポーネント

#### Routing Engine
電文を解析し、仕向け先に応じて適切なGateway Serviceに振り分ける。

| 機能 | 内容 |
|------|------|
| 電文解析 | 電文ヘッダから仕向け先を判定 |
| ルーティング | ルーティングテーブルに基づくGateway選択 |
| フェイルオーバー | Gateway障害時の自動切替 |

#### Gateway Service
CAFIS/CARDNETとの接続管理および電文変換を行う。回線ごとに配置。

| 機能 | 内容 |
|------|------|
| 電文変換 | 業務アプリ ↔ CAFIS/CARDNET電文フォーマット変換 |
| 接続管理 | CAFIS/CARDNETからの接続受付・維持（常時Listen） |
| 障害対応 | A1/A2系切替、タイムアウト、リトライ |
| 監査ログ | 通信ログ出力（PCI DSS対応） |

### 業務アプリ側の変更

| アプリ | 変更内容 |
|--------|---------|
| AP02 CAFIS業務処理サービス | 接続先をAP03→Routing Engineに変更 |
| AP22 CARDNET業務サービス | 接続先をFEXICS→Routing Engineに変更 |

詳細は [機能要件](./03-functions.md) を参照。

---

## 4. 非機能要件

### 可用性

| 項目 | 要件 |
|------|------|
| 稼働率 | 99.9%以上（既存同等） |
| 冗長構成 | Multi-AZ |
| 障害復旧 | 自動フェイルオーバー |

### 性能

| 項目 | 要件 |
|------|------|
| レスポンスタイム | 既存同等 （カード会社処理時間を含めずに100ms）|
| スループット | 既存同等以上 |
| スケール方針 | スケールアップ（処理負荷）、回線追加（帯域上限） |

### セキュリティ

| 項目 | 要件 |
|------|------|
| PCI DSS | 既存範囲を維持 |
| 通信 | 専用線経由（既存同等） |
| ログ保持 | 1年以上（PCI DSS要件） |

### 運用・監視

| 項目 | 要件 |
|------|------|
| 監視 | 可用性、レイテンシ、エラー率、リソース使用率 |
| ログ | アプリログ、通信ログ、アクセスログ |
| アラート | 閾値超過時に通知 |

