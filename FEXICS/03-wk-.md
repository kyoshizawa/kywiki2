
### 5.4 障害対応

| 機能 | 内容 |
|------|------|
| 障害取消の自動送信 | 送信成功後にエラーが発生した場合、自動的に SystemCancel を送信（金融整合性の保証） |
| A1/A2系切替 | 回線系切替 |
| タイムアウト制御 | 応答待ちタイムアウト（現行: 90秒） |
| リトライ | 通信エラー時の再試行 |
| リカバリ | 接続断時の自動再接続シーケンス |

---

## 6. Gateway Service（CAFIS）

### 6.2 接続仕様

| 項目 | 仕様 |
|------|------|
| 接続先 | CAFIS（NTTDATA） |
| 外部向けポート | 2010 |
| 接続方向 | CAFIS から接続を受ける（自社が Listen） |
| 接続コード | 2s30809-000x |

---

## 7. Gateway Service（CARDNET）

### 7.2 接続仕様

| 項目 | 仕様 |
|------|------|
| 接続先 | CARDNET（JCN） |
| 外部向けポート | 2200 |
| 接続方向 | CARDNET から接続を受ける（自社が Listen） |
| 接続コード | 3M308090001 |

### 7.3 固有処理

| 処理 | 内容 |
|------|------|
| Saison カード対応 | ICC データの 9F02 タグゼロ設定、9F5A タグ除去 |
| AMEX テスト対応 | テスト環境での ORG_CODE_CARDNET 送信 |
| BIT62 データ解析 | JCB / Saison のカスタムレスポンス解析 |
| カード有効性キャッシュ | 14日間のカード有効性結果キャッシュ |
| モード切替 | TEST / PRODUCTION の動的切替 |

---

## 8. 業務アプリ側の変更

### 8.1 AP02（CAFIS業務処理サービス）

| 項目 | 現行 | 変更後 |
|------|------|--------|
| 接続先 | AP03 (TCP:7000) | Routing Engine (TCP:7000) |
| 変更内容 | 接続先の設定変更 | ポート番号維持のため設定変更のみ |

### 8.2 AP22（CARDNET業務サービス）

| 項目 | 現行 | 変更後 |
|------|------|--------|
| 接続先 | FEXICS (DLL直接呼出し) | Routing Engine (TCP:5000) |
| 変更内容 | FexicsAPI_CN パッケージの利用 | TCP クライアントへの置き換え |

:::caution
AP22 は現行で FEXICS DLL を直接呼び出しているため、AP02 と比べて**変更範囲が大きい**。
FexicsServiceRepository の IFexicsServiceRepository インターフェースを維持しつつ、
内部実装を TCP 通信に置き換える方針とする。
:::
