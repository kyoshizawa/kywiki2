
# 一時退避

### 業務アプリ側の変更

| アプリ | 変更内容 |
|--------|---------|
| AP02 CAFIS業務処理サービス | 接続先を AP03→Routing Engine(Port 7000) に変更 |
| AP22 CARDNET業務サービス | 接続先を FEXICS→Routing Engine(Port 5000) に変更 |

### コンポーネント仕様

#### Routing Engine

| 項目 | 仕様 |
|------|------|
| 役割 | 電文解析、接続コードによるGateway振り分け |
| 実行環境 | Amazon ECS on EC2 |
| 待ち受けPort | 7000（CAFIS系）, 5000（CARDNET系） |
| スケール | 水平スケール可（ステートレス） |

**機能**:
- 電文ヘッダ解析（接続コード判定）
- ルーティングテーブルに基づくGateway選択
- Gateway障害時のフェイルオーバー

#### Gateway Service

| 項目 | 仕様 |
|------|------|
| 役割 | 電文変換、接続管理 |
| 実行環境 | Amazon ECS on EC2 |
| 待ち受けPort（外部向け） | 2010（CAFIS）, 2200（CARDNET） |
| 動作モード | **常時Listen**（CAFIS/CARDNETからの接続を受付） |
| スケール | **回線単位**（回線追加時にサーバー追加） |

**機能**:
- 電文フォーマット変換（業務アプリ ↔ CAFIS/CARDNET）
- CAFIS/CARDNETからの接続受付・維持
- A1/A2系切替、タイムアウト、リトライ
- 通信ログ出力（PCI DSS対応）



### 言語選定

| 候補 | フレームワーク | サポート期限 | 備考 |
|------|---------------|-------------|------|
| **C# (.NET 10)** | ASP.NET Core | 2028年11月（LTS） | 既存Windows環境との親和性 |

**Note:**
```
■ 比較材料
C# (.NET 10)  移行作業は軽め　PCI環境で使用言語の統一ができる
Kotlin        EOLがやや長い
```



### 廃止対象

| コンポーネント | 理由 |
|---------------|------|
| FEXICS | EOL対応（本プロジェクトの主目的） |
| AP03 CAFIS通信アプリ | FEXICS前提の設計、機能を新コンポーネントに統合 |

### 新規コンポーネント

#### Routing Engine
電文を解析し、仕向け先に応じて適切なGateway Serviceに振り分ける。

| 機能 | 内容 |
|------|------|
| 電文解析 | 電文ヘッダから仕向け先を判定 |
| ルーティング | ルーティングテーブルに基づくGateway選択 |
| フェイルオーバー | Gateway障害時の自動切替 |

#### Gateway Service
CAFIS/CARDNETとの接続管理および電文変換を行う。回線ごとに配置。

| 機能 | 内容 |
|------|------|
| 電文変換 | 業務アプリ ↔ CAFIS/CARDNET電文フォーマット変換 |
| 接続管理 | CAFIS/CARDNETからの接続受付・維持（常時Listen） |
| 障害対応 | A1/A2系切替、タイムアウト、リトライ |
| 監査ログ | 通信ログ出力（PCI DSS対応） |

### 業務アプリ側の変更

| アプリ | 変更内容 |
|--------|---------|
| AP02 CAFIS業務処理サービス | 接続先をAP03→Routing Engineに変更 |
| AP22 CARDNET業務サービス | 接続先をFEXICS→Routing Engineに変更 |
