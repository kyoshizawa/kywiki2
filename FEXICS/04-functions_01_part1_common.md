## 機能要件：共通事項

## 改訂履歴

| バージョン | 日付       | 改定内容 | 改定者 |
| ---------- | ---------- | -------- | ------ |
| v0.1       | 2026-02-19 | 初版作成 | k_yoshizawa |

---

## 本項について

新規構築するソフトウェアに適用する共通事項。

### 開発言語

| 言語 | フレームワーク | サポート期限 | 備考 |
|------|---------------|-------------|------|
| **C# (.NET 10)** | ASP.NET Core | 2028年11月（LTS） | 既存Windows環境との親和性 |

**Note:**
```
■ 比較材料
C# (.NET 10)  EOL時の移行作業は軽め　PCI環境で使用言語の統一ができる
Kotlin        EOLがやや長い
```

### 設定項目

以下の項目は、指定が無い場合も環境変数からの設定を参照すること

- 待ち受けポート
- タイムゾーン
- 処理スレッドプール数

### 通信

- コンポーネント間の通信は暗号化された通信方式を利用すること。

##### 処理サーバの追跡

- 通信データがどのサーバコンポーネントを通過して処理されたかを判断しやすくするため
  レスポンスの応答データに通過したサーバの識別子を付与する。

### ログ出力

##### 出力先

- EC2 動作の場合、出力先は D:\logs 配下のファイル出力を指定できること。
- ECS 動作の場合、出力先は **console（標準出力）** とする。

##### 保持期間

- １年以上保持（PCI DSS 要件）
  
  ※ log storage サーバに収集されるため、アプリケーションとしてはローテーション削除してよい。

##### 留意事項

- レベル **ERROR** のログを通知対象とする。
- カード番号 / 有効期限は**マスクして出力**すること。（PCI DSS 要件）

##### フォーマット

- 少なくとも以下のフィールドを含むこと。

    | カラム |
    | --- |
    | アプリケーション識別 |
    | ログレベル （INFO, WARN, ERROR）|
    | 機能識別 |
    | 内容 |

##### 契機

- 少なくとも以下の契機で出力すること。
  - システムに対するデータの入出力（通信ログ、アクセスログ）
  - 接続状態、セッションなどの内部状態変化（アプリログ）
  - 要求電文の実行結果（オーソリ・取消・アドバイス等の成否）
  - エラー発生（通信断、電文変換エラー等）


### スレッド管理

マルチスレッドで動作するため、以下の点を考慮すること。

| 機能 | 内容 |
|------|------|
| 排他制御 | 処理中の電文処理が他の電文処理に干渉しないこと |
| 処理スレッドプール数 | 環境変数により増減設定が可能とすること |
| グレースフルシャットダウン | 停止前に処理中トランザクションの完了を待機すること（最大60秒）<br/> ※ 実装的には受付停止と終了時の待機を組み込めばいい |


### 性能観測

現在の利用リソース状況を、ログなどの情報により確認できること。

