## 3.3 チェック仕様 

### 3.3.1 処理原則

(1) 貴社センタ受信電文に対する CAFIS 処理原則

| CAFISからの送信指令および状態 | 再開要求 | 終了要求 | xx要求 | 回線復旧確認指令 | 取消（再）指令 | 取消確認（再）指令 | 該当報告電文以外 |
|---|---|---|---|---|---|---|---|
| 開始指令 | ① | ① | ⑥ | ② | ⑥ | ⑥ | ① |
| xx要求 | ④ | ② | ② | ② | ② | ② | ② |
| 終了予告指令 | ① | ① | ⑥ | ② | ⑥ | ⑥ | ② |
| カウンタ通知 | ① | ① | ⑥ | ② | ⑥ | ⑥ | ① |
| 終了指令 | ① | ① | ⑥ | ② | ⑥ | ⑥ | ① |
| 回線障害回復確認指令 | ④ | ② | ② | ② | ② | ② | ② |
| 取消（再）指令 | ④ | ② | ② | ② | ② | ② | ② |
| 取消確認（再）指令 | ④ | ② | ② | ② | ② | ② | ② |
| 貴社センタ障害中 | ③ | ④ | ⑤ | ⑦ | ⑤ | ⑤ | ④ |

① 受信した電文を破棄し、指令に対する応答電文を待つ。  
② 受信した電文を有効とし通常処理を行うとともに指令（要求）に対する応答を待つ。  
③ 受信した電文を有効とし応答するとともに再開始処理を行う。  
④ 貴社センタを障害扱いとし、許可指令の送信正常により再開始とする。  
⑤ 受信した要求に対し、異常報告電文を応答し障害扱いとする。  
⑥ 受信した要求に対し、異常報告を応答するとともに指令（通知）に対する応答を待つ。  
⑦ 受信した電文を有効とし、貴社センタ障害


(2) CAFISへ電文送信後の各受信電文に対する貴社センタの処理原則

| 貴社センタ側要求出状態 | 開始指令 | xx要求 | 終了予告指令 | 終了指令 | 回線障害回復確認指令 | 取消（再）指令 | 取消確認（再）指令 | 該当報告電文以外 | カウンタ通知 |
|---|---|---|---|---|---|---|---|---|---|
| 再開始要求 | ④ | ⑦ | ③ | ③ | ② | ⑦ | ⑦ | ⑦ | ⑩ |
| 終了要求 | ① | ② | ③ | ③ | ② | ② | ② | ⑪ | ② |
| ×要求、D.T要求 | ① | ② | ② | ③ | ② | ② | ② | ⑪ | ⑫ |
| 回線障害回復確認指令 | ① | ② | ② | ③ | ② | ② | ② | ② | ② |
| 取消（再）指令 | ① | ② | ② | ③ | ② | ② | ② | ⑪ | ⑫ |
| 取消確認（再）指令 | ① | ② | ② | ③ | ② | ② | ② | ⑪ | ⑫ |
| ＣＡＦＩＳ障害中 | ④ | ⑨ | ③ | ③ | ⑥ | ⑨ | ⑨ | ⑨ | ⑨ |
| オンライン未開始（休止中） | ⑧ | ⑤ | ⑨ | ⑨ | ⑨ | ⑤ | ⑤ | ⑤ | ⑤ |

① 受信した指令に対し応答処理を行うとともに要求電文を待つ。  
② 受信した指令（要求、通知）に対し応答処理を行うとともに要求に対する応答を待つ。  
③ 要求に対する応答を待つことなく、受信した指令に対し以降の処理を行う。  
　　i）受信した指令が「終了予告指令」であれば「終了準備完了報告」を送信し「終了指令」を待つ。  
　　ii）受信した指令が「終了指令」であれば「終了報告」を送信し貴社センタは終了する。  
④ 受信した指令の応答処理を行い応答を待つことなく再開始処理を行う。  
⑤ 電文を受信しない。  
⑥ 受信した指令の応答処理を行う。  
⑦ 受信した指令（要求）を破棄し要求に対する応答を待つ。  
⑧ 貴社センタ開始準備完了時、応答処理を行う。開始準備未完了時は、指令を破棄する。  
⑨ 受信した電文を破棄する。  
⑩ 要求に対する応答を待つことなく、受信した通知に対し応答する（ＣＡＦＩＳセンタからの終了予告指令を受信後または、貴社センタが終了要求を送信後再開始要求を送信した場合）。  
⑪ 受信した報告を有効とし、要求に対する応答を待つ。  
⑫ 受信した指令の応答処理を行い、送信した要求を保留する。  


### 3.3.2 仕向センタチェック仕様

#### (1) 送信電文

(a) 被仕向会社コードはサービス対象の被仕向センタの会社コードであること。  
(b) 被仕向センタで行っている業務であること。  
(c) 取消（再）指令、取消確認（再）指令は、保留項目（電文交換仕様を参照）を保留すること。  
(d) 一般電文の送信時に、空経路があること。  
(e) CAFISセンタが障害中（全回線障害）の場合は、仕向センタに接続されている端末に対し処理の後処理を行う。  
(f) 要求電文の送信結果が正常か否かを判定し、異常の場合は端末にエラー通知を行う。  

#### (2) 受信電文

(a) 仕向センタで異常報告、取消報告、取消確認報告を受信した場合は、電文にセットされているエラーコードをチェックし、エラーコードに対応する処理を行う。  
(b) 保留項目のチェックを行う（電文交換仕様を参照）。  
(c) CAFISセンタより要求電文を送信後、規定時間を経過しても報告電文を受信しない場合はタイムオーバーとする。   
    タイムオーバー発生時に、CAFISセンタに対して表3.3.2‑1に示す電文を送信する。  

---

#### 表 3.3.2‑1 電文作成条件

| 項番 | タイムオーバー発生前の電文 | タイムオーバー発生後の電文 |
|------|------------------------------|------------------------------|
| 1 | 要求 | 取消確認指令（注1） |
| 2 | 取消確認（再）指令 | 取消確認再指令 |
| 3 | 取消（再）指令 | 取消再指令 |

**（注1）** CAFIS折返しの要求電文の場合は、障害電文を送信しない。

---

(d) 報告電文を端末へ送信時に送信不能となった場合は、CAFISセンタに取消指令を送信する。


### 3.3.3 被仕向センタチェック仕様

#### (1) 受信電文

(a) 仕向会社コードがサービス対象会社であるか否かのチェックを行い、エラーの場合は××拒否報告を応答する。  
(b) 業務のチェックを行いサービス対象外の場合は、××拒否報告を応答する。  
(c) 暗証番号チェックを必要とする場合は、要求電文に対応した××拒否報告を応答する。  
(d) 被仕向センタでその他の業務上必要なチェックを行い、業務上認められない時は××拒否報告を応答する。  

---

#### (2) 送信電文

(a) 受信した電文と同一経路で報告電文を応答する。  
(b) CAFISセンタが障害中（全回線障害）の場合は、電文保留処理を行い後処理に備える。  
(c) 報告電文の送信結果が正常か否かを判定し、異常の場合は電文保留処理を行い後処理に備える。



### 3.3.4 CAFISセンタチェック仕様

#### (1) 最大電文長チェック

受信電文長が規定長であるか否かのチェックを行い、規定長以下の場合は無効電文として電文を破棄し、規定長以上の場合は異常報告を応答する。  
なお、B改行JISコードで使用するシフトイン符号とシフトアウト符号の数を含めた電文長でチェックする。  
電文長チェック一覧を表3.3.4-1に示す。  

【表 3.3.4-1 電文長チェック一覧】

| 送信元 | 規定長（バイト） | エラーコード | エラーメッセージ |
|--------|------------------|--------------|------------------|
| 端末 | 47 ≦ 電文長 ≦ 292 | C03 | CAF03 |
| センタ | 63 ≦ 電文長 ≦ 1024 | C03 | - |

---

#### (2) 受信電文内容チェック

A. 制御電文（貴社センタ要求）受信

経路番号が「0000」の場合に以下のチェックを行い、エラーの場合は無効電文として電文を破棄する。  

(a) 仕向会社コード  
受信電文内の仕向会社コードおよび仕向会社サブコードが、CAFISセンタで管理する電文送信元の会社コード、および契約桁数と対応しているかのチェックを行う。  

(b) 電文種別  
再開始要求（7020）、終了要求（0720）、または回線障害回復確認指令（9210）であるかをチェックする。  

(c) トレーラレングス  
「000」であるかをチェックする。



B. 制御電文（貴社センタ報告）受信

経路番号が「0001」の場合、以下のチェックを行い、エラーの場合は無効電文として電文を破棄する。  

(a) 電文種別  
CAFISが送信した指令電文と対応した電文種別であるかチェックを行う。  

(b) その他  
CAFISが送信した指令電文内容を、電文種別を除いて保障しているかチェックを行う。  



C. 一般電文（貴社センタ要求）受信

経路番号が仕向経路の場合、以下のチェックを行い、エラー電文に対しては該当のエラーコードを付与した異常報告を応答する。  
一般電文（貴社センタ要求）受信時のチェックを表3.3.4‑2に示す。  


【表 3.3.4‑2 一般電文（貴社センタ要求）受信時のチェック】

| 項番 | 項目名 | チェック内容 | エラーコード |
|------|--------|--------------|--------------|
| 1 | 経路番号 | 当該仕向センタの保有する経路番号であるか | C55 |
| 2 |  | 当該経路が他の取引で使用されていないか | C51 |
| 3 | 仕向処理通番 | ニューメリックであるか | C58 |
| 4 | 仕向会社コード | 「受信電文内容チェック」のAの(a)と同様 | C53 |
| 5 | 仕向会社サブコード | 〃 | C53 |
| 6 | 被仕向会社コード | CAFISセンタに登録されている会社コードとして存在すること | C01 |
| 7 | 被仕向会社サブコード | 〃 | C01 |
| 8 | 電文種別 | CAFISサービス対象であるか | C54 |
| 9 | 仕向処理日付 | ニューメリックであるか | C58 |
|10 | 仕向処理日付 | 日付範囲内であるか（01～31） | C58 |
|11 | 仕向処理日付 | ニューメリックであるか | C58 |
|12 | 代行報告表示 | 00であるか | C56 |
|13 | トレーラレングス | ニューメリックであるか | C03 |
|14 |  | 受信電文長から63を減じた値であるか | C03 |


D. 一般電文（端末要求）受信

(a) 接続会社コード  
接続会社コードがCAFISに登録されているかチェックを行い、エラーの場合はエラーメッセージ（CAF01またはC01）を端末へ応答する。  

(b) 電文送信区分  
電文送信区分が規定された内容（1,2,3,9）であるかチェックを行い、エラーの場合はエラーメッセージ（CAF16またはC16）を端末へ応答する。  


E. 一般電文および障害電文（貴社センタ報告）受信

経路番号が被仕向経路の場合に以下のチェックを行い、エラーの場合は無効電文として破棄する。  
一般および障害電文（貴社センタ報告）受信時のチェックを表3.3.4‑3に示す。  


【表 3.3.4-3 一般および障害電文（貴社センタ報告）受信時のチェック】

| 項番 | 項目名 | チェック内容 |
|------|--------|--------------|
| 1 | 経路番号 | 当該仕向センタの保有する経路範囲であるか |
| 2 |  | 当該経路が使用中であるか |
| 3 | 仕向処理通番 | 当該経路の要求電文内容を保護しているか |
| 4 | センタ識別番号 | 同上 |
| 5 | 回線番号 | 同上 |
| 6 | CAFIS処理通番 | 同上 |
| 7 | 仕向会社コード | 同上 |
| 8 | 仕向会社サブコード | 同上 |
| 9 | 被仕向会社コード | 同上 |
|10 | 被仕向会社サブコード | 同上 |
|11 | 電文種別 | 要求電文と対応した電文種別であるか |
|12 | CAFIS処理日 | 当該経路の要求電文内容を保護しているか |
|13 | CAT送信状態表示 | 同上 |
|14 | 仕向処理日付 | 同上 |
|15 | 代行報告表示 | 同上 |
|16 | 代行電文エラー表示 | 同上 |
|17 | 代行再仕向表示 | 同上 |

 【表 3.3.4-3 一般および障害電文（貴社センタ報告）受信時のチェック（2/2）】

| 項番 | 項目名 | チェック内容 |
|------|--------|--------------|
| 18 | トレーラレングス | ニューメリックであるか |
| 19 |  | 受信電文長から63を減じた値であるか |


F. 障害電文（貴社センタ指令）受信

経路番号が仕向経路で電文種別が取消（再）指令、または取消確認（再）指令の場合は以下のチェックを行い、
エラー電文に対しては該当のエラーコードを付与した異常報告を応答する。  

 (a) 取消（再）指令

取消（再）指令受信時のチェックを表3.3.4-4に示す。  


【表 3.3.4-4 取消（再）指令受信時のチェック】

| 項番 | 項目名 | チェック内容 | エラーコード |
|------|--------|--------------|--------------|
| 1 | 経路番号 | 当該仕向センタの保有する経路範囲であるか | C55 |
| 2 | | 当該経路が他の取引で使用されていないか | C51 |
| 3 | 仕向処理通番 | ニューメリックであるか | C58 |
| 4 | センタ識別番号 | 当該仕向センタが契約する端末識別か | C56 |
| 5 | CAFIS処理通番 | ニューメリックであるか | C58 |
| 6 | 仕向会社コード | 「受信電文内容チェック」のAの(a)と同様 | C53 |
| 7 | 仕向会社サブコード | 同様 | C53 |
| 8 | 被仕向会社コード | CAFISセンタに登録されている会社コードとして存在すること | C01 |
| 9 | 被仕向会社サブコード | 該当会社の契約条件に合致すること | C01 |
|10 | CAFIS処理日 | ニューメリックであるか | C58 |
|11 |  | 日付範囲内であるか（01～31） | C58 |
|12 | 仕向処理日付 | ニューメリックであるか | C58 |
|13 |  | 日付範囲内であるか（01～31） | C58 |
|14 | トレーラレングス | ニューメリックであるか | C03 |
|15 |  | 受信電文長から63を減じた値であるか | C03 |


 (b) 取消確認（再）指令

取消確認（再）指令受信時のチェックを表3.3.4-5に示す。  

【表 3.3.4-5 取消確認（再）指令受信時のチェック】

| 項番 | 項目名 | チェック内容 | エラーコード |
|------|--------|--------------|--------------|
| 1 | 経路番号 | 当該仕向センタの保有する経路範囲であるか | C55 |
| 2 |  | 当該経路が他の取引で使用されていないか | C51 |
| 3 | 仕向処理通番 | 当該経路の電文内容を保護しているか | C56 |
| 4 | 仕向会社コード | 「受信電文内容チェック」のAの(a)と同様 | C53 |
| 5 | 仕向会社サブコード | 同様 | C53 |
| 6 | 被仕向会社コード | CAFISセンタに登録されている会社コードとして存在すること | C01 |
| 7 | 被仕向会社サブコード | 該当会社の契約条件に合致すること | C01 |
| 8 | 仕向処理日付 | 当該経路の電文内容を保護しているか | C56 |
| 9 | 代行報告表示 | 当該経路の電文内容を保護しているか | C56 |
|10 | トレーラレングス | ニューメリックであるか | C03 |
|11 |  | 受信電文長から63を減じた値であるか | C03 |


#### (3) 状態チェック

各電文の受信時に仕向センタ、被仕向センタ、およびCAFISセンタの状態をチェックし、結果により電文破棄、異常報告の応答またはエラーメッセージの応答処理を行う。  

チェック対象項目を表3.3.4-6に、電文毎の状態チェックエラー時の処理を表3.3.4-7に示す。


【表 3.3.4-6 チェック対象項目】

| 項番 | チェック対象項目 | エラー状態 | エラーコード | エラーメッセージ |
|------|------------------|------------|--------------|------------------|
| 1 | 仕向センタ | 仕向センタ未開局 | C60 | — |
| 2 |  | 仕向センタサービス対象外 | C60 | — |
| 3 | 被仕向センタ | 被仕向センタ経路無し | C12 | CAF12 |
| 4 |  | 被仕向センタ障害中 | C13 | CAF13 |
| 5 |  | 被仕向センタ休止中 | C14 | CAF14 |
| 6 |  | 被仕向センタサービス対象外 | C57 | CAF57 |
| 7 | CAFISセンタ | CAFISセンタ終了 | C15 | CAF15 |
| 8 |  | CAFISセンタ障害 | C33 | CAF33 |


 【表 3.3.4-7 電文毎の状態チェックエラー時の処理】

| 項番 | 電文区分 | エラー時の処理 |
|------|----------|----------------|
| 1 | 制御電文 | 無効電文として電文破棄し、無効電文受信前の状態に戻す |
| 2 | 一般電文（要求） | 異常報告またはエラーメッセージを応答する |
| 3 | 一般電文（報告） | 無効電文として電文破棄し、無効電文受信前の状態に戻す |
| 4 | 障害電文（要求） | 異常報告またはエラーメッセージを応答する |
| 5 | 障害電文（報告） | 無効電文として電文破棄し、無効電文受信前の状態に戻す |

### 3.3.5 エラーコード

CAFISセンタが一般電文に対する異常報告で使用するエラーコードを表3.3.5-1に、
CAFISセンタが障害電文に対する報告電文に使用するエラーコードを表3.3.5-2に示す。


 【表 3.3.5-1 CAFISセンタが一般電文に対する異常報告で使用するエラーコード】

| エラーコード | 事象 | 内容及び原因 | エラーコード受信時の仕向センタの運用 |
|--------------|------|--------------|--------------------------------------|
| C01 | 被仕向会社コードエラー | 被仕向会社コードがCAFISに登録されていない | 当該電文の処理を中止、調査する |
| C03 | 最大電文長エラー | 入力電文長が規定値を超えている | 当該電文の処理を中止、調査する |
| C12 | 被仕向センタビジー | 当該被仕向センタの全経路が使用中である | 再度電文を送信する |
| C13 | 被仕向センタ障害中 | 当該被仕向センタが障害中である | 当該電文の処理を終了する |
| C14 | 被仕向センタ個別終了 | 当該被仕向センタが終了している | 当該電文の処理を終了する |
| C15 | CAFISセンタ終了 | CAFISセンタのオンライン終了中である | 当該電文の処理を終了する |
| C33 | CAFISセンタ輻輳 | CAFISセンタが輻輳中である | 当該電文の処理を終了する |
| C50 | タイムアウト | CAFISセンタでタイムアウトを検出した | 当該電文の処理を終了する |
| C51 | 経路重複 | 使用中の仕向経路で再度電文を受信した | 当該電文の処理を中止、調査する |
| C53 | 仕向会社コードエラー | 仕向会社コードが仕向センタと不一致 | 当該電文の処理を中止、調査する |
| C54 | 電文種別エラー | CAFISセンタのサービス対象外の電文種別を受信 | 当該電文の処理を中止、調査する |
| C55 | 経路範囲外 | 当該仕向センタが保有する経路範囲外である | 当該電文の処理を中止、調査する |
| C56 | 電文対応エラー | 保護項目が保護されていない | 調査当該電文の処理を中止、調査する |
| C57 | 当該会社サービスなし | 当該被仕向センタが行っていないサービスである | 当該電文の処理を中止、調査する |
| C58 | ニューメリックチェックエラー | ニューメリックチェックにエラーがあった | 当該電文の処理を中止、調査する |
| C60 | 受信不能状態で電文受信 | 受信不能状態で電文を受信した | 当該電文の処理を終了しオンラインを再開する |


 【表 3.3.5-2 CAFISセンタが障害電文に対する報告電文に使用するエラーコード（1/2）】

| 項番 | エラーコード | 事象 | 内容及び原因 | CAFIS応答電文 | 仕向センタでの処理 | CAFISセンタでの処理 |
|------|--------------|------|--------------|--------------|--------------------|--------------------|
| 1 | C01 | 被仕向会社コードエラー | 被仕向会社コードがCAFISセンタに登録されていない | 異常報告 | 当該電文の処理を中止し調査する | — |
| 2 | C03 | 最大電文長エラー | 入力電文長が規定値を超えている | 異常報告 | 当該電文の処理を中止し調査する | — |
| 3 | C12 | 被仕向センタビジー | 当該被仕向センタの全経路が使用中である | 異常報告 | 一定時間後再度当該電文を送信する | — |
| 4 | C13 | 被仕向センタ障害中 | 当該被仕向センタが障害中である | 取消報告又は取消確認報告 | 当該電文の処理を終了する | 電文を保留し、被仕向センタへ開始後送信する |
| 5 | C14 | 被仕向センタ個別終了 | 当該被仕向センタが終了している | 取消報告又は取消確認報告 | 当該電文の処理を終了する | 電文を保留し、被仕向センタへ開始後送信する |
| 6 | C15 | CAFISセンタ終了 | CAFISセンタのオンライン終了中である | 異常報告 | オンライン開始後送信する | — |
| 7 | C33 | CAFISセンタ障害 | CAFISセンタが障害中である | 異常報告 | 一定時間後に送信し再度処理する場合は中止し調査を行う | — |
| 8 | C50 | タイムアウト | CAFISセンタで被仕向センタからの報告待ちタイムアウト検出 | 取消報告又は取消確認報告 | 一定時間後に送信し再度処理する場合は中止し調査を行う | 電文を保留し一定時間後再送する |
| 9 | C51 | 経路重複 | 使用中の仕向経路で再度電文を受信した | 異常報告 | 当該電文の処理を中止し調査する | — |
|10 | C53 | 仕向会社コードエラー | 仕向会社コードが回線上の仕向センタと不一致 | 異常報告 | 当該電文の処理を中止し調査する | — |
|11 | C54 | 電文種別エラー | CAFISセンタのサービス対象外の電文種別を受信した | 異常報告 | 当該電文の処理を中止し調査する | — |

（注）取消報告、取消確認報告にはエラーコード（C13、C14、C50）をセットする。


 【表 3.3.5-2 CAFISセンタが障害電文に対する報告電文に使用するエラーコード（2/2）】

| 項番 | エラーコード | 事象 | 内容及び原因 | CAFIS応答電文 | 仕向センタでの処理 | CAFISセンタでの処理 |
|------|--------------|------|--------------|--------------|--------------------|--------------------|
| 12 | C55 | 経路範囲外エラー | 当該仕向センタで保有する経路範囲外である | 異常報告 | 当該電文の処理を中止し調査する | — |
| 13 | C56 | 電文対応エラー | 以下の項目（保護項目）が当該経路の直前の電文と相違している ①仕向処理通番 ②仕向会社コード ③被仕向会社コード ④仕向処理日付 | 異常報告 | 処理を中止する。他取引においても発生する場合は調査する | — |
| 14 | C57 | 当該会社サービスなし | 当該被仕向センタに対するサービスを行っていない | 異常報告 | 当該電文の処理を中止し調査する | — |
| 15 | C58 | ニューメリックチェックエラー | ニューメリックチェック項目（データ部1～5の数字部）がニューメリックでない | 異常報告 | 当該電文の処理を中止し調査する | — |
| 16 | C60 | 受信不能状態で電文受信 | 以下の状態の時に電文受信 ①休止中（個別終了）のセンタから電文受信 ②障害中のセンタから電文受信 ③CAFIS一時開始後の未開始センタから電文受信 | 異常報告  | オンライン開始後送信する | — |

（注）取消報告、取消確認報告にはエラーコード（C13、C14、C50）をセットする。


3-54