## 3.3 チェック仕様 

### 3.3.1 処理原則

(1) 貴社センタ受信電文に対する CAFIS 処理原則

| CAFISからの送信指令および状態 | 再開要求 | 終了要求 | xx要求 | 回線復旧確認指令 | 取消（再）指令 | 取消確認（再）指令 | 該当報告電文以外 |
|---|---|---|---|---|---|---|---|
| 開始指令 | ① | ① | ⑥ | ② | ⑥ | ⑥ | ① |
| xx要求 | ④ | ② | ② | ② | ② | ② | ② |
| 終了予告指令 | ① | ① | ⑥ | ② | ⑥ | ⑥ | ② |
| カウンタ通知 | ① | ① | ⑥ | ② | ⑥ | ⑥ | ① |
| 終了指令 | ① | ① | ⑥ | ② | ⑥ | ⑥ | ① |
| 回線障害回復確認指令 | ④ | ② | ② | ② | ② | ② | ② |
| 取消（再）指令 | ④ | ② | ② | ② | ② | ② | ② |
| 取消確認（再）指令 | ④ | ② | ② | ② | ② | ② | ② |
| 貴社センタ障害中 | ③ | ④ | ⑤ | ⑦ | ⑤ | ⑤ | ④ |

① 受信した電文を破棄し、指令に対する応答電文を待つ。  
② 受信した電文を有効とし通常処理を行うとともに指令（要求）に対する応答を待つ。  
③ 受信した電文を有効とし応答するとともに再開始処理を行う。  
④ 貴社センタを障害扱いとし、許可指令の送信正常により再開始とする。  
⑤ 受信した要求に対し、異常報告電文を応答し障害扱いとする。  
⑥ 受信した要求に対し、異常報告を応答するとともに指令（通知）に対する応答を待つ。  
⑦ 受信した電文を有効とし、貴社センタ障害


(2) CAFISへ電文送信後の各受信電文に対する貴社センタの処理原則

| 貴社センタ側要求出状態 | 開始指令 | xx要求 | 終了予告指令 | 終了指令 | 回線障害回復確認指令 | 取消（再）指令 | 取消確認（再）指令 | 該当報告電文以外 | カウンタ通知 |
|---|---|---|---|---|---|---|---|---|---|
| 再開始要求 | ④ | ⑦ | ③ | ③ | ② | ⑦ | ⑦ | ⑦ | ⑩ |
| 終了要求 | ① | ② | ③ | ③ | ② | ② | ② | ⑪ | ② |
| ×要求、D.T要求 | ① | ② | ② | ③ | ② | ② | ② | ⑪ | ⑫ |
| 回線障害回復確認指令 | ① | ② | ② | ③ | ② | ② | ② | ② | ② |
| 取消（再）指令 | ① | ② | ② | ③ | ② | ② | ② | ⑪ | ⑫ |
| 取消確認（再）指令 | ① | ② | ② | ③ | ② | ② | ② | ⑪ | ⑫ |
| ＣＡＦＩＳ障害中 | ④ | ⑨ | ③ | ③ | ⑥ | ⑨ | ⑨ | ⑨ | ⑨ |
| オンライン未開始（休止中） | ⑧ | ⑤ | ⑨ | ⑨ | ⑨ | ⑤ | ⑤ | ⑤ | ⑤ |

① 受信した指令に対し応答処理を行うとともに要求電文を待つ。  
② 受信した指令（要求、通知）に対し応答処理を行うとともに要求に対する応答を待つ。  
③ 要求に対する応答を待つことなく、受信した指令に対し以降の処理を行う。  
　　i）受信した指令が「終了予告指令」であれば「終了準備完了報告」を送信し「終了指令」を待つ。  
　　ii）受信した指令が「終了指令」であれば「終了報告」を送信し貴社センタは終了する。  
④ 受信した指令の応答処理を行い応答を待つことなく再開始処理を行う。  
⑤ 電文を受信しない。  
⑥ 受信した指令の応答処理を行う。  
⑦ 受信した指令（要求）を破棄し要求に対する応答を待つ。  
⑧ 貴社センタ開始準備完了時、応答処理を行う。開始準備未完了時は、指令を破棄する。  
⑨ 受信した電文を破棄する。  
⑩ 要求に対する応答を待つことなく、受信した通知に対し応答する（ＣＡＦＩＳセンタからの終了予告指令を受信後または、貴社センタが終了要求を送信後再開始要求を送信した場合）。  
⑪ 受信した報告を有効とし、要求に対する応答を待つ。  
⑫ 受信した指令の応答処理を行い、送信した要求を保留する。  


### 3.3.2 仕向センタチェック仕様

#### (1) 送信電文

(a) 被仕向会社コードはサービス対象の被仕向センタの会社コードであること。  
(b) 被仕向センタで行っている業務であること。  
(c) 取消（再）指令、取消確認（再）指令は、保留項目（電文交換仕様を参照）を保留すること。  
(d) 一般電文の送信時に、空経路があること。  
(e) CAFISセンタが障害中（全回線障害）の場合は、仕向センタに接続されている端末に対し処理の後処理を行う。  
(f) 要求電文の送信結果が正常か否かを判定し、異常の場合は端末にエラー通知を行う。  

#### (2) 受信電文

(a) 仕向センタで異常報告、取消報告、取消確認報告を受信した場合は、電文にセットされているエラーコードをチェックし、エラーコードに対応する処理を行う。  
(b) 保留項目のチェックを行う（電文交換仕様を参照）。  
(c) CAFISセンタより要求電文を送信後、規定時間を経過しても報告電文を受信しない場合はタイムオーバーとする。   
    タイムオーバー発生時に、CAFISセンタに対して表3.3.2‑1に示す電文を送信する。  

---

#### 表 3.3.2‑1 電文作成条件

| 項番 | タイムオーバー発生前の電文 | タイムオーバー発生後の電文 |
|------|------------------------------|------------------------------|
| 1 | 要求 | 取消確認指令（注1） |
| 2 | 取消確認（再）指令 | 取消確認再指令 |
| 3 | 取消（再）指令 | 取消再指令 |

**（注1）** CAFIS折返しの要求電文の場合は、障害電文を送信しない。

---

(d) 報告電文を端末へ送信時に送信不能となった場合は、CAFISセンタに取消指令を送信する。


### 3.3.3 被仕向センタチェック仕様

#### (1) 受信電文

(a) 仕向会社コードがサービス対象会社であるか否かのチェックを行い、エラーの場合は××拒否報告を応答する。  
(b) 業務のチェックを行いサービス対象外の場合は、××拒否報告を応答する。  
(c) 暗証番号チェックを必要とする場合は、要求電文に対応した××拒否報告を応答する。  
(d) 被仕向センタでその他の業務上必要なチェックを行い、業務上認められない時は××拒否報告を応答する。  

---

#### (2) 送信電文

(a) 受信した電文と同一経路で報告電文を応答する。  
(b) CAFISセンタが障害中（全回線障害）の場合は、電文保留処理を行い後処理に備える。  
(c) 報告電文の送信結果が正常か否かを判定し、異常の場合は電文保留処理を行い後処理に備える。



### 3.3.4 CAFISセンタチェック仕様

#### (1) 最大電文長チェック

受信電文長が規定長であるか否かのチェックを行い、規定長以下の場合は無効電文として電文を破棄し、規定長以上の場合は異常報告を応答する。  
なお、B改行JISコードで使用するシフトイン符号とシフトアウト符号の数を含めた電文長でチェックする。  
電文長チェック一覧を表3.3.4-1に示す。  

【表 3.3.4-1 電文長チェック一覧】

| 送信元 | 規定長（バイト） | エラーコード | エラーメッセージ |
|--------|------------------|--------------|------------------|
| 端末 | 47 ≦ 電文長 ≦ 292 | C03 | CAF03 |
| センタ | 63 ≦ 電文長 ≦ 1024 | C03 | - |

---

#### (2) 受信電文内容チェック

A. 制御電文（貴社センタ要求）受信

経路番号が「0000」の場合に以下のチェックを行い、エラーの場合は無効電文として電文を破棄する。  

(a) 仕向会社コード  
受信電文内の仕向会社コードおよび仕向会社サブコードが、CAFISセンタで管理する電文送信元の会社コード、および契約桁数と対応しているかのチェックを行う。  

(b) 電文種別  
再開始要求（7020）、終了要求（0720）、または回線障害回復確認指令（9210）であるかをチェックする。  

(c) トレーラレングス  
「000」であるかをチェックする。



B. 制御電文（貴社センタ報告）受信

経路番号が「0001」の場合、以下のチェックを行い、エラーの場合は無効電文として電文を破棄する。  

(a) 電文種別  
CAFISが送信した指令電文と対応した電文種別であるかチェックを行う。  

(b) その他  
CAFISが送信した指令電文内容を、電文種別を除いて保障しているかチェックを行う。  



C. 一般電文（貴社センタ要求）受信

経路番号が仕向経路の場合、以下のチェックを行い、エラー電文に対しては該当のエラーコードを付与した異常報告を応答する。  
一般電文（貴社センタ要求）受信時のチェックを表3.3.4‑2に示す。  


【表 3.3.4‑2 一般電文（貴社センタ要求）受信時のチェック】

| 項番 | 項目名 | チェック内容 | エラーコード |
|------|--------|--------------|--------------|
| 1 | 経路番号 | 当該仕向センタの保有する経路番号であるか | C55 |
| 2 |  | 当該経路が他の取引で使用されていないか | C51 |
| 3 | 仕向処理通番 | ニューメリックであるか | C58 |
| 4 | 仕向会社コード | 「受信電文内容チェック」のAの(a)と同様 | C53 |
| 5 | 仕向会社サブコード | 〃 | C53 |
| 6 | 被仕向会社コード | CAFISセンタに登録されている会社コードとして存在すること | C01 |
| 7 | 被仕向会社サブコード | 〃 | C01 |
| 8 | 電文種別 | CAFISサービス対象であるか | C54 |
| 9 | 仕向処理日付 | ニューメリックであるか | C58 |
|10 | 仕向処理日付 | 日付範囲内であるか（01～31） | C58 |
|11 | 仕向処理日付 | ニューメリックであるか | C58 |
|12 | 代行報告表示 | 00であるか | C56 |
|13 | トレーラレングス | ニューメリックであるか | C03 |
|14 | トレーラレングス | 受信電文長から63を減じた値であるか | C03 |


D. 一般電文（端末要求）受信

(a) 接続会社コード  
接続会社コードがCAFISに登録されているかチェックを行い、エラーの場合はエラーメッセージ（CAF01またはC01）を端末へ応答する。  

(b) 電文送信区分  
電文送信区分が規定された内容（1,2,3,9）であるかチェックを行い、エラーの場合はエラーメッセージ（CAF16またはC16）を端末へ応答する。  


E. 一般電文および障害電文（貴社センタ報告）受信

経路番号が被仕向経路の場合に以下のチェックを行い、エラーの場合は無効電文として破棄する。  
一般および障害電文（貴社センタ報告）受信時のチェックを表3.3.4‑3に示す。  


【表 3.3.4-3 一般および障害電文（貴社センタ報告）受信時のチェック】

| 項番 | 項目名 | チェック内容 |
|------|--------|--------------|
| 1 | 経路番号 | 当該仕向センタの保有する経路範囲であるか |
| 2 |  | 当該経路が使用中であるか |
| 3 | 仕向処理通番 | 当該経路の要求電文内容を保護しているか |
| 4 | センタ識別番号 | 同上 |
| 5 | 回線番号 | 同上 |
| 6 | CAFIS処理通番 | 同上 |
| 7 | 仕向会社コード | 同上 |
| 8 | 仕向会社サブコード | 同上 |
| 9 | 被仕向会社コード | 同上 |
|10 | 被仕向会社サブコード | 同上 |
|11 | 電文種別 | 要求電文と対応した電文種別であるか |
|12 | CAFIS処理日 | 当該経路の要求電文内容を保護しているか |
|13 | CAT送信状態表示 | 同上 |
|14 | 仕向処理日付 | 同上 |
|15 | 代行報告表示 | 同上 |
|16 | 代行電文エラー表示 | 同上 |
|17 | 代行再仕向表示 | 同上 |
