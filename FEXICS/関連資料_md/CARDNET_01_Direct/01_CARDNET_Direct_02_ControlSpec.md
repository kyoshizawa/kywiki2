# 第２章　伝送制御仕様

本章では、CN手順におけるTCP／IPの接続条件を定義する。  
仕向センター／被仕向センターのCARDNETセンターへの接続条件はTCP／IP接続となる。  
※X.25を使用した接続回線は2018年5月でサービス提供を終了し、以降TCP／IPを使用した接続回線へ切換え済。  

仕向業務も被仕向業務も行っている場合は、２．２被仕向センター接続を参照ください。


## ２．１　仕向センター接続

### ２．１．１　接続概要

TCP／IPを使用する場合の接続概要について記述します。

### ２．１．１．１　ネットワーク構成

CARDNETセンターとの接続にTCP／IPを使用する場合には、以下のネットワークのいずれかを利用して接続します。  
各ネットワークの詳細につきましては、２．１．５以降をご参照ください。

- Master’s ONE網（以降「Master’s ONE」と記す）  
- Master’s ONE網＋セキュアインターネットVPN（以降「SIV」と記す）  
  ※株式会社NTTPCコミュニケーションズ社が提供  
- JR-NET／CN  
  ※鉄道情報システム株式会社が提供

![図](./img/2-1.png)

### ２．１．１．２　接続回線

仕向センターと各ネットワークの接続およびCARDNETセンターと各ネットワークの接続は、各ネットワーク用のアクセス回線をラウンドロビン方式で使用します。  
ネットワーク毎に使用可能なアクセス回線につきましては、２．１．５以降をご参照ください。


### ２．１．２　プロトコル仕様

TCP／IPを使用してCARDNETセンターと接続する際のプロトコル仕様について記述します。

#### ２．１．２．１　IP（Internet Protocol）レイヤ

IPレイヤにおける仕様は以下のとおりです。

##### ２．１．２．１．１　仕様基準

IPの仕様については、RFC791に準拠します。  
仕様の詳細については、同ドキュメントをご参照ください。

##### ２．１．２．１．２　IPアドレスの管理

IPアドレスは、各ネットワークより付与されたIPアドレスを使用します。  
また、仕向センターとCARDNETセンターはお互いのIPアドレスを事前に交換します。  
CARDNETセンターでは、本番業務で使用するIPアドレスとは別に、試験用のIPアドレスを保有しています。  
試験を実施する際には仕向センター側で宛先のIPアドレスを変更する必要があります。  

CARDNETセンターは各ネットワークとの接続回線障害などに備えて、複数回線で接続し、回線毎に異なるIPアドレスを保有します。

#### ２．１．２．２　TCP（Transmission Control Protocol）レイヤ

TCPレイヤにおける仕様は以下のとおりです。

##### ２．１．２．２．１　仕様基準

TCPの仕様については、RFC793に準拠します。  
仕様の詳細については、同ドキュメントをご参照ください。


##### ２．１．２．２．２　ポート番号

仕向センター及びCARDNETセンターが使用するポート番号について以下に示します。

（１）仕向センターがコネクション発行を行う場合

仕向センターからコネクションを発行する場合は、「自ポート番号は任意」、「宛先ポート番号は2200 or 5100」でコネクション確立を行います。  
CARDNETセンターは、待ちポート番号を2200 or 5100にてコネクション要求を待ちます。  

図２－２に「仕向センター発行コネクションのポート番号」を示します。  

※CARDNETセンター接続申込時に、2200と5100より宛先ポート番号をご選択いただきます。CARDNETセンターはご選択いただいたポート番号を待ちポート番号に設定します。

![図](./img/2-2.png)

（２）CARDNETセンターがコネクション発行を行う場合

CARDNETセンターからコネクションを発行する場合は、「自ポート番号は任意」、「宛先ポート番号は2200 or 5100」にてコネクション確立を行います。  
仕向センターは、待ちポート番号を2200 or 5100にてコネクション要求を待ちます。  

図２－３に「CARDNETセンター発行コネクションのポート番号」を示します。  

※仕向センターがCARDNETセンター接続申込時にご選択いただいた、2200 or 5100を宛先ポート番号として使用します。ご選択いただいたポート番号を待ちポート番号に設定してください。

![図](./img/2-3.png)

