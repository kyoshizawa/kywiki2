### 9.6.3 エラーコード編集処理

CARDNETセンターにおけるエラーコードの変換仕様を定義する。エラーコードの編集処理は、CAFISセンター経由の接続等を考慮し、以下の3パターンを想定する。

- （1）アクションコード（BIT39） → 国内レスポンスコード（BIT48） or エラーコード
- （2）エラーコード → アクションコード（BIT39）
- （3）国内レスポンスコード（BIT48） → エラーコード

---

**（1）アクションコードおよび国内レスポンスコード（エラーコード）編集処理**

CARDNETセンターは、①仕向センターからのアドバイスの要求電文受信時、②被仕向センターからの要求の応答電文受信時に国内レスポンスコードがデフォルト設定（設定フラグ"00"かつ国内レスポンスコードがスペース）の場合、アクションコードに従い国内レスポンスコードを編集する。

【図】図9-6-3-1

**表9-9　アクションコード・国内レスポンスコード変換表**

| 項番 | アクションコード | 国内レスポンスコード | 内容 |
|---|---|---|---|
| 1 | 000 | スペース | 承認許可 |
| 2 | 100 | G12 | 取扱拒否（カード使用不可） |
| 3 | 103 | G30 | 取扱保留、アクワイアラー連絡（保留） |
| 4 | 200 | G56 | カード回収、アクワイアラー連絡（無効カード、カード取込） |
| 5 | その他 | G99 | 接続要求受付拒否 |

---

**（2）エラーコードおよびアクションコード編集処理**

CARDNETセンターは、①CAFIS経由の被仕向センターからの要求の応答電文受信時にエラーコードに従いアクションコードを編集する。

①要求中継時のコード編集処理

【図】図9-6-3-2

**表9-10　エラーコード・アクションコード対応表**

| 項番 | エラーコード | アクションコード | 内容 |
|---|---|---|---|
| 1 | スペース | 000 | 承認許可 |
| 2 | CXX | 909 | CAFISセンターにて検知したエラー（障害中、システム不調） |
| 3 | G30 | 103 | 保留（取扱保留、アクワイアラー連絡） |
| 4 | G56 | 200 | 無効カード、カード取込（カード回収、アクワイアラー連絡） |
| 5 | その他 | 100 | 取扱拒否 |

---

**（3）国内レスポンスコード・エラーコード編集処理**

CARDNETセンターは、①仕向センターへの要求の応答電文を折返し送信時に、CAFIS経由の被仕向センター結果通知を送信する場合、国内レスポンスコードに従いエラーコードを編集する。

①要求中継時のコード編集処理（イシュアダイレクト時）

【図】図9-6-3-3

注1：CAFIS経由の結果通知中継時、エラーコードは、データ部1－0 承認コードエリアに設定する。
注2：イシュアダイレクト処理の詳細は「CARDNET接続条件書（代行機能編）」を参照。

**表9-11　国内レスポンスコード・CAFISエラーコード対応表**

| 項番 | 国内レスポンスコード | エラーコード | 内容 |
|---|---|---|---|
| 1 | PXX / KXX | G99 | CARDNETセンターが検知した被仕向センター側のエラー（接続要求受付拒否） |

---

## 9.7 CAFIS手順への変換について

被仕向センターがCAFIS経由の接続の場合、仕向センターからCN手順で受信した電文をCAFIS手順に変換して被仕向センターへ送信する。本項では、特に留意すべき変換仕様や各手順の違いについて記載する。

### 9.7.1 BIT22：POSデータコードを使用した変換

**（1）1桁目**

BIT22：POSデータコード（1桁目）は、CAFIS手順のデータ部9－7－1、9－7－4の「IC対応端末フラグ」の設定に使用する。変換仕様は下表のとおり。

**表9-12　CAFIS手順「IC対応端末フラグ」の設定仕様**

| CN手順 BIT22：POSデータコード 1桁目 | CAFIS手順 データ部9－7－1、9－7－4 IC対応端末フラグ |
|---|---|
| 5/C | 1：接触EMV対応端末（MS＋IC）端末 |
| A | 3：非接触EMV対応端末、接触EMV有り |
| B | 4：非接触MS専用端末、接触EMV無し |
| 上記以外 | 0：初期値（設定不可）または接触MS専用端末（接触EMV無し） |

**（2）2桁目**

BIT22：POSデータコード（2桁目）は、CAFIS手順のデータ部9－7－1、9－7－3、9－7－4の「PIN入力機能」の設定に使用する。変換仕様は下表のとおり。

**表9-13　CAFIS手順「PIN入力機能」の設定仕様**

| CN手順 BIT22：POSデータコード 2桁目 | CAFIS手順 データ部9－7－1、9－7－3、9－7－4 PIN入力機能 |
|---|---|
| 1/7/8/9 | 1：PIN入力可能 |
| 上記以外 | 0：不明 |

**（3）7桁目**

BIT22：POSデータコード（7桁目）は、CAFIS手順のデータ部9－7－1、9－7－3、9－7－4の「PAN入力モード」の設定に使用する。変換仕様は下表のとおり。

**表9-14　CAFIS手順「PAN入力モード」の設定仕様**

| CN手順 BIT22：POSデータコード 7桁目 | CAFIS手順 データ部9－7－1、9－7－3、9－7－4 PAN入力モード |
|---|---|
| 1/6/Y | 01：マニュアル入力（非接触） |
| 2 | 90：MS読込（接触） |
| 5/V | 05：接触ICチップ読込（EMV仕様） |
| A | 07：非接触ICチップ読込（EMV仕様） |
| B | 91：MS読込（非接触） |
| S/T/U | 95：フォールバック |
| 上記以外 | （データ部9－7－1、9－7－3、9－7－4は設定されない） |

---

### 9.7.2 3-D Secure関連情報の設定方法

CN手順とCAFIS手順では、3-D Secureのバージョン毎の3-D Secure関連情報の設定有無が異なる。CN手順からCAFIS手順へ変換する際の3-D Secure関連情報の設定有無を表9-15に示す。

**表9-15　CN手順からCAFIS手順へ変換時の3-D Secure関連情報の設定有無**

| 3-D Secureのバージョン | CN手順 BIT63タグA03 | CN手順 BIT63タグA07 | CAFIS手順 データ部9－1－2 | CAFIS手順 データ部9－1－3 |
|---|---|---|---|---|
| 1.0 | ○ | × | ○ | × |
| 2.0 | ○ | △（注2） | ○ | ○（注3） |

【凡例】 ○：設定あり、×：設定なし、△：任意。

- 注1：仕向要求電文のBIT63タグA03の「3DS2.0認証フラグ」が"1"の場合、3DS2.0認証を行う。
- 注2：使用有無はカード会社の基準による。
- 注3：仕向要求電文タグA07が設定されていない場合、被仕向要求電文のデータ部9－1－3の「DS Transaction ID」と「3DS Server Transaction ID」には、ALLスペースを設定して、被仕向センターへ中継する。
