# 4.8 電文編集設定表

## 4.8.1 電文編集 API 設定項目

電文編集 API によってセットされるフィールドは以下の通りです。

| BIT | BIT内容 | 属性 | Set Source / API | Code Type | Length |
|-----|---------|------|------------------|-----------|--------|
| 2 | 会員番号 | JIS8 | FX_BuildAuthMsg(): 会員番号（引数）<br>FX_BuildAdviceMsg(): 会員番号（引数） | n..19 | LLVAR21 |
| 3 | プロセッシングコード | JIS8 | FX_BuildAuthMsg(): アプリケーションタイプ（引数）<br>FX_BuildAdviceMsg(): アプリケーションタイプ（引数） | n6 | 6 |
| 4 | 取引金額 | JIS8 | FX_BuildAuthMsg(): 引数をそのままセット<br>FX_BuildAdviceMsg(): 引数をそのままセット | n12 | 12 |
| 14 | 有効期限 | JIS8 | FX_BuildAuthMsg(): 会員番号（引数）<br>FX_BuildAdviceMsg(): 会員番号（引数） | n4 | 4 |
| 17 | 収集日 | JIS8 | FX_BuildAuthMsg(): (Default: カット対象日付)<br>FX_BuildAdviceMsg(): (Default: カット対象日付) | n4 | 4 |
| 18 | 商品コード | JIS8 | FX_BuildAuthMsg(): (Default: 設定ファイル)<br>FX_BuildAdviceMsg(): (Default: 設定ファイル) | n4 | 4 |
| 22 | POSデータコード | JIS8 | FX_BuildAuthMsg(): トランザクションタイプ（引数）<br>FX_BuildAdviceMsg(): トランザクションタイプ（引数） | an12 | 12 |
| 24 | ファンクションコード | JIS8 | FX_BuildAuthMsg(): アプリケーションタイプ（引数）<br>FX_BuildAdviceMsg(): アプリケーションタイプ（引数） | n3 | 3 |
| 35 | JIS1 第2トラック情報 | JIS8 | FX_BuildAuthMsg(): 会員番号（引数）<br>FX_BuildAdviceMsg(): 会員番号（引数） | ans..37 | LLVAR39 |
| 38 | 承認コード | JIS8 | FX_BuildAdviceMsg(): 引数をそのままセット | anp6 | 6 |
| 39 | アクションコード | JIS8 | FX_BuildAdviceMsg(): 引数をそのままセット | n3 | 3 |
| 41 | 加盟店端末番号 | JIS8 | FX_BuildAuthMsg(): 引数をそのままセット<br>FX_BuildAdviceMsg(): 引数をそのままセット | n8 | 8 |
| 47 | JIS2 トラック情報 | JIS8 | FX_BuildAuthMsg(): 会員番号（引数）<br>FX_BuildAdviceMsg(): 会員番号（引数） | ans69 | LLLVAR72 |
| 48 | 国内レスポンスコード | JIS8 | FX_BuildAdviceMsg(): (Default: 設定ファイル) | anp5 | LLLVAR8 |
| 52 | 入力暗証番号 | Binary | FX_BuildAuthMsg(): PIN（引数） | b64 | 8 |
| 55 | ICカード関連データ | Binary | FX_BuildAuthMsg(): 会員番号（引数）<br>FX_BuildAdviceMsg(): 会員番号（引数） | b..2040 | LLLVAR258 |
| 56 | Original Data Element | JIS8 | FX_SetField() | anp35 | LLVAR37 |
| 59 | 端末出力データ | JIS8 | FX_SetField() | ans147 | LLLVAR150 |
| 60 | 国内使用予約域（分割） | JIS8 | FX_BuildAuthMsg(): 引数をそのままセット<br>FX_BuildAdviceMsg(): 引数をそのままセット | ans1..121 | LLLVAR124 |
| 62 | 個社利用予約域 | Binary | FX_SetField() | b..968 | LLLVAR124 |
| 63 | カードネット拡張使用域 | Binary | FX_SetField() | b..968 | LLLVAR124 |
| 72 | データレコード | JIS8 | FX_SetField() | ans..340 | LLVAR343 |

### 【Set Source 凡例】

- **FX_BuildAuthMsg() / FX_BuildAdviceMsg()**  
  アプリケーションが各 API のパラメータで明示的に設定するフィールド。  
  FX_SetField() による上書きは可能。

### 【Type 凡例】

- a : 英字  
- an : 英字、数字  
- n : 数字  
- anp : 英字、数字、パッド文字  
- p : パッド文字（スペース）  
- ans : 英字、数字、特殊文字  
- s : 特殊文字  

※ type に続く桁数が「..n」と記されているものは、最大 n 桁の可変長を表す。

---

## 4.8.2 FEXICS Daemon 設定項目

FEXICS Daemon によって設定されるフィールドは以下の通りです。

| BIT | BIT内容 | 属性 | FEXICS の Set Source | Code Type | Length |
|-----|---------|------|---------------------|-----------|--------|
| 11 | System Trace Audit | JIS8 | 通番ファイル | n6 | 6 |
| 12 | 現地取引時間 | JIS8 | システム日付 | n12 | 12 |
| 25 | メッセージ理由コード | JIS8 | "9999" | n4 | 4 |
| 26 | 加盟店業種コード | JIS8 | 設定ファイル | n4 | 4 |
| 28 | 精査日 | JIS8 | カットオーバー日付 | n6 | 6 |
| 30 | オリジナル金額 | JIS8 | 元電文取引金額 | n24 | 24 |
| 32 | 加盟店会社コード | JIS8 | 設定ファイル | anp11 | LLVAR13 |
| 37 | Retrieval Reference | JIS8 | 通番ファイル | anp12 | 12 |
| 42 | 加盟店番号 | JIS8 | 設定ファイル | anp15 | 15 |
| 43 | 加盟店名／所在地 | JIS8 | 設定ファイル | anp40 | LLVAR42 |
| 49 | 取引通貨コード | JIS8 | 設定ファイル | n3 | 3 |
| 50 | 精査通貨コード | JIS8 | 設定ファイル | n3 | 3 |
| 53 | セキュリティー関連制御 | JIS8 | 専用処理 | an14 | LLVAR16 |
| 58 | オーソリ判定センターID | JIS8 | 設定ファイル | anp11 | LLVAR13 |
| 74 | 売上取消／返品件数 | JIS8 | 集計値 | n10 | 10 |
| 75 | 売上障害取消件数 | JIS8 | 集計値 | n10 | 10 |
| 76 | 売上件数 | JIS8 | 集計値 | n10 | 10 |
| 77 | 売上取消／返品障害取消件数 | JIS8 | 集計値 | n10 | 10 |
| 80 | 照会件数 | JIS8 | 集計値 | n10 | 10 |
| 81 | オーソリ件数 | JIS8 | 集計値 | n10 | 10 |
| 82 | 照会障害取消件数 | JIS8 | 集計値 | n10 | 10 |
| 86 | 売上取消／返品金額 | JIS8 | 集計値 | n16 | 16 |
| 87 | 売上障害取消金額 | JIS8 | 集計値 | n16 | 16 |
| 88 | 売上金額 | JIS8 | 集計値 | n16 | 16 |
| 89 | 売上取消／返品障害取消金額 | JIS8 | 集計値 | n16 | 16 |
| 90 | オーソリ障害取消件数 | JIS8 | 集計値 | n10 | 10 |
| 93 | 電文送信先センターID | JIS8 | 設定ファイル | anp11 | LLVAR13 |
| 94 | 電文送信元センターID | JIS8 | 設定ファイル | anp11 | LLVAR13 |
| 96 | Key Management Data | JIS8 | 集計値 | (a3)+b64 | LLLVAR11/13 |
| 97 | 精査合計金額 | JIS8 | 集計値 | a+n16 | 17 |
| 100 | 精査対象会社コード | JIS8 | 設定ファイル | anp11 | LLVAR13 |

### 【Set Source 凡例】

- 設定ファイル：FEXICS の設定ファイルに記載された値をセット  
- 通番ファイル：FEXICS の通番ファイルに記録されている値をセット  
- 集計値：FEXICS 内部で集計した、各取引金額・件数などの値をセット

---

# 4.9 デビットカード取引固有の電文設定

デビットカード取引では、以下に示すフィールドの値の設定が  
クレジット取引と異なります。

## デビットカード取引で設定が異なるフィールド

| BIT | BIT内容 | 拡張内容概略 |
|-----|---------|--------------|
| 2 | 会員番号 | JIS2 読込時、会員番号／口座番号または郵貯記号番号となる |
| 3 | プロセッシングコード | デビット残高確認、売上、売上取消。またそれぞれについての障害取消に使用 |
| 22 | POS データコード | マニュアル入力は不可 |
| 24 | ファンクションコード | デビット残高確認、売上、売上取消。またそれぞれについての障害取消に使用 |
| 43 | 加盟店名／所在地 | 通帳印字の方式が記述されている場合あり |
| 52 | 入力暗証番号 | JIS2 読込時、日本デビットカード推進協議会指定のスクランブルが必要 |
| 59 | 端末出力データ | フィールド構成が拡張（銀行、支店コードなど…）。デビットと J-Debit では異なる |
| 60 | 国内使用予約域 | 端末識別番号、支払区分、税／その他、取消返品区分の内容が変更 |
| 62 | 個社使用予約域 | EC デビット、電話での売上の際、値の設定が必要 |

---

CARDNET の接続仕様書では、  
デビットカード取引に関して、以下のように定義されています。

1. デビットカード取引電文のデビット識別は、  
   **電文種別コード**で差を持たせる。

2. デビット決済網の選択は CARDNET で行い、  
   応答電文のヘッダー中に  
   **加盟店契約会社コード**をセットする。

---

クレジット取引では、  
売上電文は加盟店から加盟店契約会社や  
カード発行会社を宛先として送信されますが、  
デビットカード取引では、  
**DEBIT または J-DEBIT 決済網に直接送信**されます。

カード発行銀行の選択は、  
すべてデビット決済網によって決定されます。

デビット決済網の選択は、  
加盟店と CARDNET の間で事前に決定しておき、  
オンライン時には CARDNET によって  
自動的に選択されます。

---

# 4.10 ICカード取引固有の電文設定

ICカードの取引における相違点を以下に示します。

1. **ARQC オーソリ**は同期中継型で処理されます。  
   その他の電文は、非同期中継型で処理されます。

2. ICカードチップの項目仕様で、CARDNET がサポートしているものは以下のとおりです。  
   （2004 年 3 月現在）

   - JCB：J/Smart 2.0  
   - VISA：VSDC 1.4  
   - Master：M/Chip 4.0  
   - AMEX：AEIPS 4.0  
   - Diners：Diners 1.1  
   - 国内アプリケーション：D/Smart 1.2  

---

ICカード取引では、以下に示すフィールドの値の設定が  
クレジット取引と異なります。

## ICカード取引で設定が異なるフィールド

| BIT | BIT内容 | 拡張内容概略 |
|-----|---------|--------------|
| 2 | 会員番号 | マニュアル入力は不可 |
| 12 | 現地取引時刻 | 同期中継型電文、障害取消電文は、CARDNET のシステム時間で上書き |
| 22 | POS データコード | カードデータ入力方法、会員の認証方法、カード取込機能、カードデータ入力モードのコード追加 |
| 35（JIS1 IC） | JIS1 第2トラック情報 | ICカード入力時、ICチップ内の「Track 2 Equivalent Data」（Tag57）がセットされる |
| 38 | 承認コード | ARQC 時のみ番号が設定される。その他はすべて「0」 |
| 47（JIS2 IC） | JIS2 トラック情報 | ICカード入力時、ICチップ内の「JIS2 Equivalent Data」（Tag DF4F）がセットされる |
| 55 | ICカード関連データ | 各ブランドが指定する IC 関連データをそのままセット。ARQC オーソリに関しては別途必須項目を指定 |
| 58 | オーソリ判定会社コード | ARQC 時のみオーソリ判定会社コードがセットされる |

---

# 4.11 ギフトカード取引固有の電文設定

ギフトカード取引における相違点を以下に示します。

現状、CARDNET センターとしてのギフトカード被仕向会社は  
**「凸版印刷」のみ**です。（2007 年 11 月現在）

## 4.11.1 処理種別とコード体系

既存のクレジットカード取引と同様の取引種別コードを使用しますが、  
**種別の意味内容が異なります。**

| 処理種別 | 電文種別コード | MTI | プロセッシングコード（BIT3） | ファンクションコード（BIT24） |
|---|---|---|---|---|
| アクティベート | C100 / C110 | 1100 / 1110 | 000000 | 101 |
| アクティベート取消 | C100 / C110 | 1100 / 1110 | 200000 | 101 |
| 残高照会 | C100 / C110 | 1100 / 1110 | 010000 | 100 |
| チャージ（入金） | C200 / C210 | 1200 / 1210 | 200000 | 201 |
| チャージ（入金）取消 | C200 / C210 | 1200 / 1210 | 000000 | 201 |
| 売上（出金） | C200 / C210 | 1200 / 1210 | 000000 | 200 |
| 売上（出金）取消／返品 | C200 / C210 | 1200 / 1210 | 200000 | 200 |
| 障害取消 | C420（C421）/ C430 | 1420（1421）/ 1430 | 元取引と同様 | 400 |

## 4.11.2 BODY 部の相違

| BIT | BIT内容 | 拡張内容概略 |
|---|---|---|
| 25 | メッセージ理由コード | 「9600」固定（クレジットサービスは「9999」） |
| 48 | 国内レスポンスコード | 被仕向センターからの応答コードが拡張される |

### ギフトカードサービス エラーコード

| コード | 内容 |
|---|---|
| GT1 | 残高不足 |
| GT2 | 入金金額オーバー |
| GT3 | 未アクティベート |
| GT4 | 利用開始前 |
| GT5 | すでにアクティベート済み |
| GT6 | 未登録端末からの要求 |

### BIT62 個社使用予約域（応答時付加）

TLV 方式で付加されるフィールド内容は以下のとおりです。

| タグ | 長さ | 内容 |
|---|---|---|
| T01 | 8 バイト | ギフトカード利用前残高 |
| T02 | 8 バイト | ギフトカード利用後残高 |
| T03 | 4 バイト | カードステータス |
| T04 | 8 バイト | カード有効期限（YYYYMMDD） |

---

# 4.12 中国銀聯カード取引固有の電文設定

中国銀聯カード取引では、以下に示すフィールドの値の設定が  
クレジット取引と異なります。

## 中国銀聯カード取引で設定が異なるフィールド

| BIT | BIT内容 | 拡張内容概略 |
|---|---|---|
| 22 | POS データコード | 7 桁目を「D」固定 |
| 59 | 端末出力データ | カナ氏名フラグ／カナ氏名が、クレジット／デビット識別フラグ、クレジット／デビット識別となる |
| 63 | カードネット拡張使用域 | セキュリティ関連方法伝達域として固有フォーマットが必要 |

※ BIT22（POS データコード）は、  
電文作成後に **FX_SetField()** により、  
上位アプリケーションが中国銀聯カード取引用の値を設定する必要があります。  
設定時は、**7 桁目を「D」**としてください。

各 FEXICS API で指定するトランザクションタイプは、  
クレジット取引と同様です。

ただし、以下の電文について注意が必要です。

### 売上取消／返品（暗証番号あり）に関する注意

- 売上返品（暗証番号入力あり）電文は、  
  **BIT52 および BIT53 がビットオフ**となるため、  
  「暗証番号あり」の売上返品は実行できません。
- 売上返品を行う場合は、  
  トランザクションタイプとして  
  **必ず「暗証番号なし」**を指定してください。
- ※ 売上取消については、「暗証番号入力あり」の指定が可能です。