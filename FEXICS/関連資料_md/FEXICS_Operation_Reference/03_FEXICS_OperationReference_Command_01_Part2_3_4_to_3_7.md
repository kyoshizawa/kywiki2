## 3.4 fxmsgコマンド

クレジット決済センターとの接続を制御するには、fxmsgコマンドラインプログラムを使用します。

### コマンドフォーマット

fxmsg_cn <parameter> ： FEXICS Daemon for CARDNETとCARDNETセンターとの接続を制御します。  
fxmsg_cf <parameter> ： FEXICS Daemon for CAFISとCAFISセンターとの接続を制御します。

### parameter
signon ： クレジット決済センターに対してサインオン要求電文を送信します。  
signoff ： クレジット決済センターに対してサインオフ要求電文を送信します。  
cutreq ： CARDNETセンターに対してカットオーバー依頼電文を送信します。  
　　　　または、カット対象処理日付を更新します(CAFIS接続サービス使用時)。  
cancel ： クレジット決済センターに対して指定された電文に対する取消処理を行ないます。  
cntreq ： CAFISセンターに対してカウンタ照会要求電文を送信します。  


### 3.4.1 サインオン(signon)

クレジット決済センターに対してサインオン要求電文を送信して、接続の開始を要求します。

#### コマンドフォーマット

[ fxmsg_cn | fxmsg_cf ] signon   ... API ： FX_Connect ()

このコマンドは、FEXICS Daemonがどの状態でも実行できます。


### 3.4.2 サインオフ(signoff)

クレジット決済センターに対してサインオフ要求電文を送信して、接続の終了を要求します。

#### コマンドフォーマット

[ fxmsg_cn | fxmsg_cf ] signoff   ... API ： FX_Disconnect()

サインオフ要求が出された時点で仕掛中の処理を完了させた後、FEXICS Daemonはサインオフ状態になります。  
このコマンドが処理を開始した後は、すべてのアプリケーションプログラムからのAPIコールはエラーとなります。  
クレジット決済センターがこのサインオフ要求に対して応答を戻さなかった旨のメッセージが表示された場合は、強制終了の停止コマンドを実行しFEXICS Daemonを終了する必要があります。  
FEXICS Daemonを使用しているアプリケーションプログラムがあると処理は行われません。アプリケーションプログラムの停止を確認してから実行してください。


### 3.4.3 カットオーバー依頼(cutreq)

CARDNETセンターに対してカットオーバー依頼電文を送信します。または、カット対象日付を更新します。

#### コマンドフォーマット

[ fxmsg_cn | fxmsg_cf ] cutreq   ... API ： FX_SendCutOverMsg()

このコマンドは、FEXICS Daemonがサインオン状態のときにのみ実行できます。

CARDNET接続サービスを使用している場合は、CARDNETセンターに対し、カットオーバー依頼電文を送信されます。  
CAFIS接続サービスでは、FEXICS Daemonに対してカット対象日付の更新が依頼されます。CARDNET接続サービスとは異なり、電文は送信されません。ジャーナルファイルが切り替わります。


### 3.4.4 電文取消(cancel)

指定された電文に対する障害電文を送信します。元電文は指定された電文参照キーを元にジャーナルファイルから検索されます。  
CAFIS接続サービスでは、売上・与信・取消業務電文に対して使用できます。  
CARDNET接続サービスとCAFIS接続サービスとでは、用いる電文参照キーが異なります。

#### コマンドフォーマット

fxmsg_cn cancel  "取引通番"    ...API ： FX_SendSystemCancel_CN()  
fxmsg_cf cancel  "処理年月日” “端末識別番号” “端末処理通番" ...API ： FX_SendSystemCancel_CF()

<CARDNET接続サービス 電文参照キー>：  
取引通番  APIに戻される取引ごとの通番

<CAFIS接続サービス電文参照キー>：  
処理年月日 データ部[1-0]の処理年月日(YYMMDD)  
端末識別番号 データ部[1-0]の端末識別番号  
端末処理通番 データ部[1-0]の端末処理通番  

※値にブランクを含む場合は、その項目をダブルクォーテーション（"）で囲んでください。

障害取消対象元となる電文はジャーナルファイルに含まれていなければなりません。  
このコマンドは、FEXICS Daemonがサインオン状態のときにのみ実行できます。


### 3.4.5 カウンタ照会要求(cntreq)

CAFISセンターに対してカウンタ照会要求電文を送信します。(CARDNET接続では、当機能はありません)

#### コマンドフォーマット

fxmsg_cf cntreq

このコマンドは、FEXICS Daemonがサインオン状態のときにのみ実行できます。


## 3.5 fxsessionコマンド

FEXICS Daemonとクレジット決済センター間のTCPセッション状況を、fxsessionコマンドラインプログラムによって確認できます。

### コマンドフォーマット

```
fxsession_cn
```
FEXICS DaemonとCARDNETセンター間のセッション状況を表示します。

```
fxsession_cf <parameter>
```
FEXICS DaemonとCAFISセンター間のセッション状況の表示および管理をします。

| parameter | 説明 |
|--------|------|
| purge | 使用中の経路を強制的に開放 |

---

### 3.5.1 セッション情報の表示

FEXICS Daemonとクレジット決済センター間のセッション情報が出力されます。

#### コマンド
```
fxsession_cn
fxsession_cf
```

TCP/IP情報が出力されます。

クレジット決済センターによって表示内容が異なります。

#### CARDNET接続サービス

FEXICS Daemon for CARDNET と CARDNETセンター間の TCP/IP情報が表示されます。

例：
```
C:\> fxsession_cn
CREDIT SETTLEMENT CENTER        CARDNET
TCP/IP情報 (local-remote)
connect to 10.111.112.113:1161-10.122.123.124:2100
connect to 10.111.112.113:1162-10.122.123.125:2100
accept from 10.122.123.124:2100-10.111.112.113:1163
accept from 10.122.123.125:2100-10.111.112.113:1164
```

---

#### CAFIS接続サービス

TCP/IP情報に加えて経路情報が表示されます。

経路状態：

| 表示 | 意味 |
|------|------|
| CLOSE | セッション未確立 |
| OPEN | 空き経路 |
| 数値表示 | 使用中経路 |

使用中経路の場合、以下が表示されます。

- 電文種別  
- 処理年月日  
- 端末識別番号  
- 端末処理通番  

---

##### 出力例（未確立）

```
C:\> fxsession_cf
CREDIT SETTLEMENT CENTER        CAFIS
TCP/IP情報 (local-remote)
経路情報 (状態,処理年月日,端末識別番号,端末処理通番)
ROUTE  0 CLOSE
ROUTE  2 CLOSE
ROUTE  4 CLOSE
ROUTE  6 CLOSE
ROUTE  8 CLOSE
```

---

##### 出力例（確立時）

```
C:\> fxsession_cf
CREDIT SETTLEMENT CENTER        CAFIS
TCP/IP情報 (local-remote)
accept from 10.122.123.124:2100-10.111.112.113:1161
accept from 10.122.123.125:2100-10.111.112.113:1164

経路情報 (状態,処理年月日,端末識別番号,端末処理通番)
ROUTE  0 OPEN
ROUTE  2 3210 030303 3333333333333 00020
ROUTE  4 OPEN
ROUTE  6 OPEN
ROUTE  8 OPEN
```

---

### 3.5.2 経路の開放

CAFIS接続サービスにおいて、使用中の経路を強制的に開放します。

#### コマンド
```
fxsession_cf purge <経路番号>
```

指定した番号の経路を強制開放します。  
指定可能な経路番号は、`fxsession_cf`表示結果の **2以上の経路番号** です。

省略形：
```
p = purge
```

#### 実行例
```
C:\> fxsession_cf p 2
I801 経路を開放しました。
```

## 3.6 fxviewコマンド

### 3.6.1 fxviewコマンドについて

FEXICSの各種ファイルをオフラインで表示するには、fxviewコマンドラインプログラムを使用します。

#### コマンドフォーマット

```
fxview_cn
fxview_cf
```

- **fxview_cn** ： CARDNETサービスファイル表示用  
- **fxview_cf** ： CAFISサービスファイル表示用  

fxviewコマンドは以下の情報を表示できます。

---

#### ■ ジャーナル出力

**CARDNET**
```
fxview_cn journal ファイル名 [/n 取引通番]
```
- bit11 = システムトレース監査番号

**CAFIS**
```
fxview_cf journal ファイル名 [/d 処理年月日 /t 端末識別番号 /s 端末処理通番]
```
- データ部1‑0（処理年月日・端末識別番号・端末処理通番）

---

#### ■ 精査電文記録情報出力

```
fxview_cn reconcile 精査日(YYMMDD)
fxview_cf reconcile 精査日(YYMMDD) [被仕向会社コード | CAFIS]
```

---

#### ■ イベント情報出力

```
fxview_cn event ファイル名
fxview_cf event ファイル名
```

---

#### ■ 精査集積情報出力

```
fxview_cn sum ファイル名
fxview_cf sum ファイル名 [被仕向会社コード | * | CR | DB]
```

---

#### ■ 省略パラメータ

| 正式 | 省略 |
|------|------|
| journal | j |
| reconcile | r |
| event | e |
| sum | s |

#### コマンドフォーマット

```
[fxview_cn | fxview_cf] j j1.dat  
```
指定したジャーナルファイル内容をすべて表示  

```
fxview_cn j j1_cn.dat /n123  
```
通番指定して特定のレコードのみ表示（指定：CARDNET）  

```
fxview_cf j j1_cf.dat /d020601 /t3333333333333 /s00123  
```
処理年月日、端末識別番号、端末処理通番を指定して特定のレコードを表示（指定：CAFIS）  
※値にブランクを含む場合は、その項目をダブルクォーテーション（"）で囲んでください。  

```
fxview_cn r 020430  
```
指定した精査日の精査電文を表示（CARDNET）  

```
fxview_cf r 020430 2a9966x0000  
```
指定した精査日の精査電文の内、引数に指定した被仕向会社の電文のみを表示（CAFIS）  

```
fxview_cf r 020430 CAFIS  
```
指定した精査日の精査電文の内、CAFISからのカウンタ通知電文のみを表示（CAFIS）  

```
[fxview_cn | fxview_cf] e event_cn_020501.log  
```
指定したイベントログファイルの情報を表示  

```
fxview_cn s sum_cn_020501.dat  
```
指定した精査ファイルの情報を表示（CARDNET）  

```
fxview_cf s sum_cf_020501.dat  
```
指定した精査集積ファイルの情報から、全ての被仕向会社の精査情報の累計情報を表示（CAFIS）  

```
fxview_cf s sum_cf_020501.dat 2a9966x0000  
```
指定した精査集積ファイルの情報から、引数に指定した被仕向会社コードにおける精査情報を表示（CAFIS）  

```
fxview_cf s sum_cf_020501.dat CR  
```
指定した精査ファイルの情報から、クレジット取引の累計情報を表示（CAFIS）  

```
fxview_cf s sum_cf_020501.dat DB  
```
指定した精査集積ファイルの情報から、デビット取引の累計情報を表示（CAFIS）  

```
fxview_cf s sum_cf_020501.dat CUP  
```
指定した精査集積ファイルの情報から、中国銀聯カード取引の累計情報を表示（CAFIS）  

```
fxview_cf s sum_cf_020501.dat *  
```
指定した精査集積ファイルの情報をすべて表示（CAFIS）  
（全被仕向会社コード別の精査情報および累計情報表示）

---

### 3.6.2 ジャーナル参照（fxviewコマンド）時のマスキングについて

マスキング対象のデータは、会員番号、有効期限、暗証番号です。  
※エンコード内容（JIS1Track2，JIS2）のカード番号、有効期限、暗証番号を含みます。  

会員番号については JCCA 準拠の場合は下 4 桁を、PCIDSS 準拠の場合は上 12 桁を非表示にします。  
デビットカードの場合は、会員番号の全桁を非表示にします。  
有効期限、暗証番号については全桁を非表示にします。  

#### 3.6.2.1 CARDNET電文のマスキングについて

CARDNET電文のマスキング対象データは下記のとおりです。  

<CARDNETマスキング対象データ>：

1. BIT2 会員番号  
2. BIT14 有効期限  
3. BIT35 JIS1 Track2情報 ※1  
4. BIT47 JIS2情報 ※1  
5. BIT52 暗証番号  
6. BIT55 ICカード関連データ ※2  

※1 [JIS1Track2]，[JIS2] の詳細は「2.3 エンコード内容のマスキングについて」をご参照下さい。  
※2 ICカード関連データの詳細は「2.4 ICカード関連データのマスキングについて」をご参照下さい。  

#### 3.6.2.2 CAFIS電文のマスキングについて

CAFISデータ部のマスキング対象データは下記のとおりです。  

<CAFISマスキング対象データ>：

1. 会員番号  
   - データ部[1-1][2-10][9-7-3] のエンコード内容 ※1  
   - データ部[9-7-1][9-7-3][9-7-4] のICカード関連データ ※2  
   - データ部[1-6] の会員番号  
2. 有効期限  
   - データ部[1-1][2-10][9-7-3] のエンコード内容 ※1  
   - データ部[9-7-1][9-7-3][9-7-4] のICカード関連データ ※2  
   - データ部[1-6] の暗証番号  
3. 暗証番号  
   - データ部[1-1][2-10][9-7-3] のエンコード内容 ※1  

※1 エンコード内容の詳細は「2.3 エンコード内容のマスキングについて」をご参照下さい。  
※2 ICカード関連データの詳細は「2.4 ICカード関連データのマスキングについて」をご参照下さい。  

#### 3.6.2.3 エンコード内容のマスキングについて

エンコード部分のマスキングについては下記のとおりです。  

<JIS1 Track2のマスキング対象データ>  
1. 会員番号  
2. 有効期限  

例）  
- JCCA準拠：`123456789012****=****1012080000000000`  
- PCIDSS準拠：`************1108=****1012080000000000`  

<JIS2のマスキング対象データ>  
1. 会員番号  
2. 有効期限  
3. 暗証番号  

例）  
- JCCA準拠：`a9****0661123456789012****5010000000000****000000000000000000000000000`  
- PCIDSS準拠：`a9****0661************11085010000000000****000000000000000000000000000`  

#### 3.6.2.4 ICカード関連データのマスキングについて

ICカード関連データのマスキングについては下記のとおりです。  

< ICカード関連データのマスキング対象データ>  
1. [5A]タグ 会員番号  
2. [5F24]タグ 有効開始日  
3. [5F25]タグ 有効期限  

例）  
- JCCA準拠：  
  `5a08478904555555****9f0206000000030000…5f2503******5f2403******9f21031933059f070･･･`  
- PCIDSS準拠：  
  `5a08************55509f0206000000030000…5f2503******5f2403******9f21031933059f070･･･`  

### 3.6.2.5 マスキング方式の設定について

マスキング方式の設定は、`FX_ROOT/config` の設定ファイルで設定します。  

---

## 3.7 fxreplaceコマンド

パラメータなしで実行します。  
当該コマンドを実行することでアプリケーションの入替を行います。  

#### コマンドフォーマット

```bash
fxreplace_cf
fxreplace_cn
```

- `fxreplace_cf`：アプリケーション入替処理を実行します（CAFISセンター用）  
- `fxreplace_cn`：アプリケーション入替処理を実行します（CARDNETセンター用）  

#### 説明

アプリケーション入替用フォルダが存在する場合、実行フォルダ名に日時を追加してバックアップフォルダとしてリネームし、  
入替用フォルダ名を実行フォルダ名にリネームします。  

ログは、アプリケーション入替処理が正常終了、またはエラーが発生した場合に出力します。  
入替処理が起動しなかった場合は、ログ出力を行わず削除します。  
※入替処理が起動し、正常に処理が終了した場合、エラーログは削除します。  

