## 4. FEXICSアプリケーションの入替手順

### 4.1 前提条件
1. ディスク容量に十分な空きがなければ、正常にインストールできません。  
2. 本機能は Runtime Kit のみの対応になります。

---

### 4.2 fxsetupツール実行
FX_ROOTディレクトリ名に「_replace」を付与し、ディレクトリを作成します。  
作成したディレクトリにアプリケーションファイルを展開します。  

「3. REPLACEMENT」モードに限り、FEXICS Daemon 起動中に実行可能です。

#### コマンドフォーマット
```
CARDNET : fxsetup_cn <Full Path>
CAFIS   : fxsetup_cf <Full Path>
```

#### 入替準備方法
アプリケーションの入替準備を行う場合は「3. REPLACEMENT」を選択してください。

**注意**  
FEXICS Runtime Base Kit および FEXICS Runtime Service Kit がインストールされていない状態で  
「3. REPLACEMENT」を選択すると、インストールは正常終了しますが、FEXICSデーモンは起動できません。

---

### 4.3 fxdstartコマンド実行
パラメータなしで実行します。  
FEXICS Daemon 起動時に本ツールを使用してください。

#### コマンドフォーマット
```
fxdstart_cf : アプリケーション入替処理後、FEXICS Daemonを起動します。(CAFISセンター用)
fxdstart_cn : アプリケーション入替処理後、FEXICS Daemonを起動します。(CARDNETセンター用)
```

#### 前提条件
1. 本コマンドでエラーが発生した場合、その時点で処理を終了し、FEXICSデーモンは起動しません。  
2. 設定ファイルは、既存で使用している設定ファイルを使用します。  

※設定ファイルに項目が追加・削除されている場合は、設定ファイルのメンテナンスを行ってください。

#### 説明
本コマンドは、以下の手順を実行します。

1. FEXICS Daemon が起動している場合、強制的に終了します。  
2. FEXICS Daemon が起動していないことを確認後、アプリケーション入替処理を実行します。  
3. 入替処理が正常終了した場合、FEXICSデーモンを起動します。

---

### 4.4 アプリケーション入替処理の流れ（CAFIS例）

#### 基本フロー
1. インストーラーでファイルを展開する（fxsetup 実行）  
2. 実行フォルダ名に日時を付与してバックアップフォルダへリネーム  
   - `%FX_ROOT%` → `%FX_ROOT%_YYYYMMDDhhmm`
3. 入替用フォルダ名から `_replace` を外し、実行フォルダ名に変更  
   - `%FX_ROOT%_replace` → `%FX_ROOT%`

---

#### ファイル展開時エラー対処
1. fxsetup 実行時、インストール先を絶対パス指定しているか確認  
2. `%FX_ROOT%_replace` フォルダが存在する場合は削除  
3. fxsetup を再実行

---

#### ファイル削除エラー対処
1. バックアップフォルダ名から日時を削除し、実行フォルダ名へリネーム  
2. 実行フォルダを参照していないことを確認  
3. 入替用フォルダを参照していないことを確認  
4. fxdstart_xx.bat を再実行
